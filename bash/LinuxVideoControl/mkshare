#!/bin/sh

## Скрипт создает каталог для новой камеры и частично конфигурирует Samba

# Version 1.0

# Подключаем общую для всех скриптов библиотеку функций.
. ./functions

#
# Первичные процедуры - создание файла блокировки, запись в лог файл о начале выполнения.
#

lock_on
log_msg "Запущен"

#####

# Основная программа.

# Если аргументов при запуске скрипта нет - выходим с ошибкой.
if [ "$1" != "" ]; then

	mkdir "$camshare$1" # Создаем каталог для новой камеры
	chmod 777 "$camshare$1" # Меняем права доступа
	
	# Дописываем в конфиг-файл samba сервера нужные строки.
	echo -e "\n[$1]\n  comment = $1\n  browseable = yes\n  path = $camshare$1\n  printable = no\n  guest ok = yes\n  read only =no\n  create mask = 0700" >> /etc/samba/smb.conf

	# Перезапускаем samba.
	service smbd restart
	
	# Выводим дополнительное напоминание про включение IP камеры в общий ACL список Samba сервера.
	echo "!!! Не забудьте проверить наличие IP адреса камеры в Samba ACL, находится в начале секции с описаниями общих каталогов для камер, и перезагрузить samba сервер: sudo service smbd restart"

	log_msg "Общий каталог $1 успешно создан."

    else

	# Просим после имени скрипта ввести название каталога для камеры.
	echo "Введите имя каталога после $0"

    fi

#####

# 
# Окончательные процедуры - удаление временного файла, запись в лог-файл, удаление файла блокировки.
#

log_msg "Завершен"
lock_off
